- 姓名：傅锦龙
- 班级：1621301
- 学号：162130117
- 报告阶段：lab1
- 完成日期：2023.4.17
- 本次实验，我完成了所有内容。

## 目录

[TOC]

## 1. Nuaa_question1

- 思路

~(x & y)实现的是只要不同时为1则为1，只要除掉同时为0取1的情况便实现了异或，而~x & ~y实现的是只有同时为0则为1，则~(~x & ~y)实现的是同时为0则为0，这样就排除掉了同时为0取1的情况。

- 代码
```c
int bitXor(int x, int y)
{
    return ~(~x & ~y) & ~(x & y);
}
```

- 测试截图（dlc btest）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715580648-29f2d0c3-401b-4cb0-88ff-266172a2b837.png#averageHue=%23300a25&clientId=udc961898-a411-4&from=paste&height=345&id=uf86c0082&originHeight=604&originWidth=942&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=110472&status=done&style=none&taskId=u70a960e2-030f-42bc-b2ec-aec28a20d70&title=&width=538.2857142857143)
## 2. Nuaa_question2

- 思路

按位反再加一即可。

- 代码
```c
int negate(int x)
{
    return ~x + 1;
}
```

- 测试截图（dlc btest）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715584772-d6257f52-a823-4284-be77-241ae459bc97.png#averageHue=%23300a25&clientId=udc961898-a411-4&from=paste&height=345&id=u661b551a&originHeight=604&originWidth=942&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=110472&status=done&style=none&taskId=ud96ba4de-3b45-4bd4-89c3-73b9ffd4cd1&title=&width=538.2857142857143)
## 3. Nuaa_question3

- 思路

先将x加上一个偏移量，然后再右移n位。偏移量的计算方式是，如果x是负数，则加上2^n-1，否则加上0，通过x符号位扩展到32位与上2^n-1的结果来实现。

- 代码
```c
int divpwr2(int x, int n)
{
    return (x + ((x >> 31) & ((1 << n) + ~0))) >> n;
}
```

- 测试截图（dlc btest）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715589032-f366cdc9-6c08-47ee-beb9-05dd38de5406.png#averageHue=%23300a25&clientId=udc961898-a411-4&from=paste&height=345&id=ud2b0a2fb&originHeight=604&originWidth=942&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=110472&status=done&style=none&taskId=u039eda96-cdba-46c1-9550-073a22df3d1&title=&width=538.2857142857143)
## 4. Nuaa_question4

- 思路

将x向右移位n位并将高n位清0，再将x向左移位32-n位，最后将这两个结果进行或运算得到结果。

- 代码
```c
int rotateRight(int x, int n)
{
    int t = ~n + 33;
    return ((x >> n) & ((1 << t) + ~0)) | (x << t);
}
```

- 测试截图（dlc btest）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715599194-a25dcbd4-d52b-4335-abb8-073f3f814fc2.png#averageHue=%23300a25&clientId=udc961898-a411-4&from=paste&height=345&id=u8ee6cf1b&originHeight=604&originWidth=942&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=110472&status=done&style=none&taskId=u5f1d3208-ca5d-4c35-9ffd-e32f928f8a8&title=&width=538.2857142857143)
## 5. Nuaa_question5

- 思路

如果x和y的符号位相同，但是x+y的符号位与x的符号位不同，那么就会溢出。先不取符号位，先运算，最后再移位得到符号位的情况。先通过异或运算判断x和y的符号位以及x+y与x的符号位是否相同，通过取反和与运算确定当溢出时运算结果符号位才为1，通过位运算得到符号位扩展，非一下得到最终结果。

- 代码
```c
int addOK(int x, int y)
{
    return !((~(x ^ y) & (x ^ (x + y))) >> 31);
}
```

- 测试截图（dlc btest）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715602760-6492f78d-896f-4f12-a3d7-8e061533a8d3.png#averageHue=%23300a25&clientId=udc961898-a411-4&from=paste&height=345&id=uaee257f4&originHeight=604&originWidth=942&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=110472&status=done&style=none&taskId=u36f2f7fc-449c-4bab-adc8-85c537d2708&title=&width=538.2857142857143)
## 6. Nuaa_question6

- 思路

先得到阶码exp和符号位sign，小数部分f通过uf向左移8位，并在最高位赋值为1，先作为正数看待，为了避免之后判断阶码来进行左移或右移，直接都进行右移，且为了避免算数右移，将结果赋值给无符号数。因为Nan和inf都返回0x80000000,因此0x80000000可包含在判断exp>157的情况内，而剩余有效的数的绝对值范围都在2^31内且对称，所以可行。为避免移位过多，须先判断exp是否小于127，最后f右移相应位数，根据sign判断是否需要取负数，结果为f。

- 代码
```c
int float_f2i(unsigned uf)
{
    int exp = (uf >> 23) & 0xff;
    int sign = uf & 0x80000000;
    unsigned f = (uf << 8) | 0x80000000;
    if (exp > 157)
        return 0x80000000;
    if (exp < 127)
        return 0;
    f >>= (158 - exp);
    if (sign)
        return -f;
    return f;
}
```

- 测试截图（dlc btest）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715608068-4ffa6eb0-eb4c-463d-a4e3-3232e648c5fd.png#averageHue=%23300a25&clientId=udc961898-a411-4&from=paste&height=345&id=uf3bbdc19&originHeight=604&originWidth=942&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=110472&status=done&style=none&taskId=u49425b1b-14b1-4bfb-bb26-e4dc5b91b1f&title=&width=538.2857142857143)
## 7. 最终结果

- ./driver.pl 截图

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715671646-b4cec56f-fc77-4a56-8554-e366eb230b29.png#averageHue=%23310a25&clientId=udc961898-a411-4&from=paste&height=446&id=ub6e5fad2&originHeight=780&originWidth=906&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=112783&status=done&style=none&taskId=u9521ced6-945a-46ee-9ded-d85278fb84c&title=&width=517.7142857142857)

- 挑战教授截图（必须是你的学号）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22784909/1681715460675-3916b172-76b7-48fe-a5f0-fdc24cdeb483.png#averageHue=%23dad7d7&clientId=udc961898-a411-4&from=paste&height=58&id=u771b498a&originHeight=102&originWidth=972&originalType=binary&ratio=1.75&rotation=0&showTitle=false&size=14712&status=done&style=none&taskId=u66c1fe38-a030-4157-bf63-33fa8eaac5a&title=&width=555.4285714285714)
## 8. 备注

助教真帅
